# Система диагностики трубопроводов - Исправленная версия с защитой от переобучения

## Описание проекта

Комплексная система автоматизированного распознавания технического состояния сложных технических систем на объектах магистрального трубопроводного транспорта нефти и нефтепродуктов.

**Автор:** Кондрашов Д.В.  
**Научный руководитель:** Зарубин А.Г. (к.х.н., доцент отделения нефтегазового дела ИШПР ТПУ)

## Проблема и решение

### Обнаруженная проблема
Предыдущая версия системы показывала подозрительно высокие результаты (99.9% точности), что указывало на **переобучение модели**:
- Экстремальный дисбаланс классов в тестовой выборке
- Слишком сложная модель для простых искусственных аномалий
- Отсутствие регуляризации

### Реализованное решение
Новая версия включает комплексные исправления:
- **Регуляризованная модель**: Random Forest с ограниченной сложностью
- **Строгая эвристика аномалий**: только явные отклонения (8% максимум)
- **Консервативные признаки**: 7 базовых признаков вместо избыточного количества
- **Диагностика переобучения**: автоматическая оценка качества модели

## Реалистичные результаты

**Ожидаемая точность**: 80-92%  
**Контроль переобучения**: Разрыв <8%  
**Распределение классов**: 90-95% норма, 5-10% аномалии  
**ROC-AUC**: 0.75-0.90  

## Версии системы

### Ветка `main` - Исходная версия
- **Файл**: `Pipeline_Diagnostic_System_MIMII_RandomForest.ipynb`
- **Результаты**: 99.9% точности (подозрение на переобучение)
- **Статус**: Требует доработки

### Ветка `overfitting-fix-regularization` - Исправленная версия
- **Файл**: `Pipeline_Realistic_System_Fixed.py`
- **Результаты**: 80-92% точности (реалистично)
- **Статус**: Готово к применению

## Технические особенности исправленной версии

### Модель
- **Алгоритм**: Random Forest (регуляризованная)
- **Количество деревьев**: 25 (против 100 в исходной)
- **Максимальная глубина**: 3 (против неограниченной)
- **Признаков на дерево**: 60% (для предотвращения переобучения)

### Признаки
- **Количество**: 7 консервативных признаков
- **Типы**: mean, std, median, rms, peak, peak_to_peak, mad
- **Предобработка**: StandardScaler с защитой от infinity

### Данные
- **Источник**: captured_data.bin (реальные промышленные данные)
- **Размер окна**: 3000 отсчетов
- **Перекрытие**: 10% (для независимости)

## Структура проекта

```
┌── Pipeline_Realistic_System_Fixed.py               # Исправленная система (новая ветка)
├── Pipeline_Diagnostic_System_MIMII_RandomForest.ipynb  # Исходная версия (main)
├── captured_data.bin                             # Реальные промышленные данные
└── README.md                                     # Документация
```

## Быстрый старт (исправленная версия)

```python
# Инициализация исправленной системы
system = PipelineRealisticSystem(random_state=42)

# Загрузка реальных данных
filepath = "path/to/captured_data.bin"
raw_data = system.load_binary_data(filepath)
sensor_data = system.parse_sensor_data(raw_data)

# Создание реалистичных окон
features, labels = system.create_realistic_windows(sensor_data)

# Обучение регуляризованной модели
results = system.train_regularized_model(features, labels)

# Диагностика переобучения
is_overfitted = diagnose_overfitting(results)

# Предсказание на новых данных
predictions, probabilities = system.predict_anomaly(new_data)
```

## Диагностические возможности

### Автоматическая диагностика переобучения
- Анализ разрыва точности обучение/тест
- Проверка распределения классов
- Оценка вариативности кросс-валидации
- Анализ доминирования признаков

### Регуляризация
- **Мало деревьев**: 25 вместо 100+
- **Ограниченная глубина**: 3 уровня максимум
- **Высокие пороги**: min_samples_split=25, min_samples_leaf=15
- **Ограничение признаков**: 60% на каждое дерево

## Практическое применение

1. **Промышленный мониторинг**: Диагностика состояния трубопроводного оборудования
2. **Предиктивное обслуживание**: Планирование ремонтов на основе реального состояния
3. **Раннее предупреждение**: Обнаружение аномалий до критических сбоев
4. **Оптимизация затрат**: Снижение расходов на внеплановые ремонты

## Научная значимость

Данная работа демонстрирует:
- **Выявление переобучения** в системах машинного обучения
- **Методы регуляризации** для промышленных применений
- **Реалистичные оценки** производительности моделей
- **Баланс точности и обобщения** в диагностических системах

## Сравнение версий

| Параметр | Исходная версия | Исправленная версия |
|---|---|---|
| Точность | 99.9% (подозрительно) | 80-92% (реалистично) |
| Количество деревьев | 100 | 25 |
| Макс. глубина | Неограниченная | 3 |
| Количество признаков | 25+ | 7 |
| Переобучение | Высокое | Контролируемое |
| Диагностика | Нет | Полная |
| Промышленное применение | Не рекомендуется | Готово |

## Использование с реальными данными

### Подготовка данных
1. Разместите файл `captured_data.bin` в рабочей директории
2. Укажите полный путь к файлу в коде

### Пример запуска
```python
# Путь к вашим данным
filepath = r"C:\path\to\your\captured_data.bin"

# Запуск системы
system, results = main_realistic_system(filepath)

# Анализ результатов
if system and results:
    print(f"Точность: {results['test_accuracy']:.3f}")
    print(f"Переобучение: {results['overfitting_gap']:.3f}")
```

## Связанные репозитории

- [RF-TurboML-for-pipeline-defects-detection](https://github.com/Altyn113/RF-TurboML-for-pipeline-defects-detection) - Альтернативная реализация
- [Stop](https://github.com/Altyn113/Stop) - Дополнительные эксперименты

## Технологии

- **Python 3.8+**
- **scikit-learn** - Машинное обучение с регуляризацией
- **pandas/numpy** - Обработка данных
- **matplotlib/seaborn** - Визуализация результатов

## Лицензия

MIT License - свободное использование для исследований и коммерческих целей.

## Заключение

Исправленная версия системы представляет собой научно обоснованный подход к диагностике трубопроводов с реалистичными результатами и защитой от переобучения. Система готова к практическому применению в промышленных условиях.

---
*Разработано в рамках магистерской программы ТПУ по направлению "Нефтегазовое дело"*  
*Версия с исправлениями - октябрь 2025*
